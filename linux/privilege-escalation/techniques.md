# Techniques

## Kernel exploits

Enumerate the kernel version:

```text
uname -a 
cat /etc/issue
```

Use searchsploit to find matching exploits:

```text
searchsploit linux kernel <version> priv esc

# or you can use https://github.com/jondonas/linux-exploit-suggester-2
./linux-exploit-suggester-2.pl -k <version>
```

## Service exploits

Show processes running as root:

```text
ps aux | grep "^root"
netstat -nl
```

Enumerate program versions:

```text
<service> -v
<service> --version
dpkg -l | grep <service>
rpm -qa | grep <service>
```

Search for exploits

## Weak file permissions

```text
# Find all writable files in /etc: 
find /etc -maxdepth 1 -writable -type f

# Find all readable files in /etc: 
find /etc -maxdepth 1 -readable -type f

# Find all directories which can be written to:
find / -executable -writable -type d 2> /dev/null
```

#### /etc/shadow

1. Crack root hash.
2. Replace original hash with new:

```text
mkpasswd -m sha-512 <newpassword>
```

#### /etc/passwd

1. Delete `x` , works on older systems.
2. Replace `x` with new password hash generated by `openssl passwd "<newpassword>"` .
3. Append new user with UID 0, but different username.

## Backups

Look for interesting files:

```text
ls -la /
ls -la /tmp
ls -la /var/backups
```

## Sudo

```text
# Run a program using sudo:
sudo <program>

# Run a program as a specific user: 
sudo -u <user> <program>

# List programs a user is allowed (and disallowed) to run:
sudo -l
```

Other ways to escalate privileges with sudo:

```text
sudo -s
sudo -i
sudo /bin/bash
sudo passwd
```

Shell escape sequences for more programs can be found here:

```text
https://gtfobins.github.io/
```

## Cron jobs

Located in:

```text
/var/spool/cron/
/var/spool/cron/crontabs/
/etc/crantab
```

The crontab PATH environment variable is by default set to `/usr/bin:/bin`

## SUID / SGID files

```text
find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l {} \;2> /dev/null
find / -user <user> -perm -4000 -exec ls -ldb {} \; 2>/dev/null
```

```text
https://github.com/Anon-Exploiter/SUID3NUM
```

```text
# Running strings against a file:
strings <file>

# Running strace against a command:
strace -v -f -e execve <command> 2>&1 | grep exec

# Running ltrace against a command:
ltrace <command>
```

