# Techniques

## Kernel exploits

Enumerate the kernel version:

```text
uname -a 
cat /etc/issue
```

Then use searchsploit / linux-exploit-suggester / google to find matching exploits:

```text
searchsploit linux kernel <version> priv esc

# or you can use https://github.com/jondonas/linux-exploit-suggester-2
./linux-exploit-suggester-2.pl -k <version>
```

## Service exploits

Firstly enumerate processes running as root.

```text
ps aux | grep "^root"
netstat -nl
```

Then enumerate their versions.

```text
<service> -v
<service> --version
dpkg -l | grep <service>
rpm -qa | grep <service>
```

Search for exploits for enumerated software versions.

## Stored secrets / weak file permissions

Always search through history files.

```text
history
cat ~/.bash_history
cat ~/*_history
```

Also search for files containing "password", "pass", "pwd".

```text
find . -type f -exec grep -i -I "PASSWORD" {} /dev/null \;
```

Don't overlook possible interesting files and directories with bad permissions.

```text
# Find all writable files in /etc: 
find /etc -maxdepth 1 -writable -type f

# Find all readable files in /etc: 
find /etc -maxdepth 1 -readable -type f

# Find all directories which can be written to:
find / -executable -writable -type d 2> /dev/null
```

### /etc/shadow \(default: -rw-r--r--\)

Things you can do:

1. If a file is readable, you can try to crack root hash.
2. If a file is writable, you can replace original hash.

{% page-ref page="../../password-attacks/cracking-hashes-1.md" %}

You can generate new sha-512 \("$6$"\) hash of a password with this command.

```text
mkpasswd -m sha-512 <newpassword>
```

### /etc/passwd \(default: -rw-------\)

Things you can do when the file is writable:

1. Deleting `x` , can disable password on older systems.
2. Replacing `x` with a new password hash generated by `openssl passwd "<newpassword>"` .
3. Append new user with UID 0, but different username.

### SSH keys \(id\_rsa / authorized\_keys\)

```text
find / -name authorized_keys 2>/dev/null
find / -name id_rsa 2>/dev/null
```

## Backups

Look for interesting files, also backups can be found in these locations.

```text
ls -la /
ls -la /tmp
ls -la /var/backups
```

## Sudo

```text
# Run a program as a specific user: 
sudo -u <user> <program>

# List programs a user is allowed (and disallowed) to run:
sudo -l
```

Other ways to escalate privileges with sudo:

```text
sudo -s
sudo -i
sudo /bin/bash
sudo passwd
```

Shell escape sequences for more programs can be found here:

```text
https://gtfobins.github.io/
```

## Cron jobs

Crons are located in:

```text
/var/spool/cron/
/var/spool/cron/crontabs/
/etc/crantab
```

The crontab PATH environment variable is by default set to `/usr/bin:/bin`

## SUID / SGID files

```text
find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l {} \;2> /dev/null
find / -user <user> -perm -4000 -exec ls -ldb {} \; 2>/dev/null
```

```text
https://github.com/Anon-Exploiter/SUID3NUM
```

```text
# Running strings against a file:
strings <file>

# Running strace against a command:
strace -v -f -e execve <command> 2>&1 | grep exec

# Running ltrace against a command:
ltrace <command>
```

